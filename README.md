﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿# Naraku#### #### 安装： ``npm install naraku@latest --registry=https://registry.npmjs.org`` 或 `` yarn add naraku@latest --registry=https://registry.npmjs.org``从npm源安装最新版#### #### 引入： ```//  DataHub 和 $Transform 是 naraku 的两个核心组件import { DataHub,  $Transform } from 'naraku';```## ##  DataHub组件   DataHub是适合BI和OA系统的Store类组件，对常见数据和状态管理提供一站式解决方案。   其主要特性能是**数据及状态的依赖管理**，用来解决数据级联时需要手动请求数据问题。 ## ### 快速上手-在React中使用DataHub组件:```import React from 'react';import { DataHub,  $Transform } from 'naraku'; /*  示例场景：根据选中的省份，获取城市列表*//*==注册数据请求方法，在实际项目中通常是写在独立的文件中===*/// 获取省份列表APIDataHub.addFetcher('getProvince', (args)=>{  const {    param,  // 这个是请求参数，数据类型是Object    data, // 这个是提交的数据，数据类型是Array    form // 是否是表单数据集，数据类型Boolean } = args; // 实际项目中通常是异步请求数据  return [{name: '辽宁省'},{name: ‘浙江省’}];});// 获取城市列表APIDataHub.addFetcher('getCity', (args)=>{  const {    param,  // 这个是请求参数，数据类型是Object    data, // 这个是提交的数据，数据类型是Array    form // 是否是表单数据集，数据类型Boolean } = args;if (param.name === '辽宁省')  {  return [{name: '沈阳市'},{name: '大连市'}]}if (param.name === '浙江省')  {  return [{name: '杭州市'},{name: '宁波市'}]}  return []；});/*====================================*/// 通过DataHub.inject方法将DataHub注入到React组件中 @DataHub.inject({  // 参数是数据配置信息，用来配置数据直接的关系  // 获取城市列表  city: {  // city是数据集在DataHub中的名字     type:  'getCity',  // type是数据请求方法名     dependence: 'selectedProvince' // 依赖项：选中的省份，只有满足依赖后才会请求数据  },  // 获取省份列表  province: {  // province是数据集在DataHub中的名字    type:  'getProvince'      // 没有依赖项，因此当DataHub组件初始化以后自动请求数据  },  myData: { //  没有type，表示是本地数据    default: [{name: '张三'}]  //  default表示初始化数据  }})class NarakuDemo extends React.Component{  componentWillMount() {    // DataHub注入到React组件中，默认的变量名是dh（DataHub）;    console.log(this.dh);      // 同时生成的还有一个与组件生命周期相同的Controller，用于组件和dh的交互，当组件销毁时，Controller所有的方法失效    console.log(this.dhController);       // 读取数据集中的数据    console.log(this.dhController.get('myData'));   // 数据集中的数据将被统一封装成数组，读取不存在的数据集返回空数组    // 将数据写入数据集：选中的省份是浙江省，数据作为请求参数     this.dhController.set('selectedProvince', {name: '浙江省'}) // 此时满足了依赖条件DataHub请求数据，获取城市列表       // when函数用来监听数据集的数据变化，当数据变化时，触发回调,与事件不同的是如果在监听之前已有数据，将立即返回数据    this.dhController.when('city',  (data) => {      console.log(data)    });  } render() {  // 当数据和数据的状态发生变化时，自动重新渲染  console.log(this.dh.get('city));  //get等方法可以直接用dh对象调用  return null; }}```### DataHubController的API方法 | 说明| 使用场景|示例|------|------|-----------|----|get|    |  |hasRunner|   |  |first|   |  |refresh|   |  |submit|  |  |set|  | |assign0     |       |        |delete     |       |        | emit    |       |        |snapshot     |       |        |reset     |       |        |status     |       |        | load    |       |        |loading     |       |        |ready     |       |        |## Transformer